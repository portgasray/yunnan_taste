"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[76],{3:function(t,e,s){s.d(e,{Jh:function(){return c},Lr:function(){return n},OH:function(){return r},kN:function(){return a}});let r=function(t){return t["DEVELOPMENT"]="development",t["STAGING"]="staging",t["PRODUCTION"]="production",t}({});const i={[r.DEVELOPMENT]:{baseUrl:"https://dev-api.yunnan-taste.example.com/v1",timeout:1e4,useMocks:!0},[r.STAGING]:{baseUrl:"https://staging-api.yunnan-taste.example.com/v1",timeout:1e4,useMocks:!1},[r.PRODUCTION]:{baseUrl:"https://api.yunnan-taste.example.com/v1",timeout:1e4,useMocks:!1}};let o=r.DEVELOPMENT;const a=t=>{o=t},n=()=>o,c=()=>i[o]},2471:function(t,e,s){s.d(e,{x3:function(){return J},Ke:function(){return G},Pj:function(){return B},j_:function(){return W},kH:function(){return V}});var r=s(6540),i=s(3443),o=s(4705),a=s(7813),n=s(758),c=s.n(n),d=s(3);class h{constructor(){(0,o.A)(this,"requestInterceptors",[]),(0,o.A)(this,"responseInterceptors",[])}addRequestInterceptor(t){return this.requestInterceptors.push(t),()=>{const e=this.requestInterceptors.indexOf(t);-1!==e&&this.requestInterceptors.splice(e,1)}}addResponseInterceptor(t){return this.responseInterceptors.push(t),()=>{const e=this.responseInterceptors.indexOf(t);-1!==e&&this.responseInterceptors.splice(e,1)}}async request(t,e="GET",s,r,i=1){const o=(0,d.Jh)();let a={url:`${o.baseUrl}${t}`,method:e,data:s,header:{"Content-Type":"application/json",...r?{Authorization:`Bearer ${r}`}:{}},timeout:o.timeout};for(const t of this.requestInterceptors)a=t.onRequest(a);try{const o=await c().request(a);let n=o;for(const t of this.responseInterceptors)n=t.onResponse(n);if(n.statusCode>=200&&n.statusCode<300)return{success:!0,data:n.data};{const o={success:!1,error:n.data?.message||"Request failed",code:n.statusCode};return n.statusCode>=500&&i>0?this.request(t,e,s,r,i-1):o}}catch(o){let a=o;for(const t of this.responseInterceptors)a=t.onError(a);const n={success:!1,error:a.message||"Network error",code:a.statusCode||0};return i>0?this.request(t,e,s,r,i-1):n}}}const u=new h,l=[{id:"p1",title:"\u4e91\u5357\u666e\u6d31\u8336 - \u53e4\u6811\u719f\u8336",price:128,originalPrice:168,image:"https://example.com/products/tea1.jpg",images:["https://example.com/products/tea1.jpg","https://example.com/products/tea1_detail1.jpg","https://example.com/products/tea1_detail2.jpg"],description:"\u91c7\u81ea\u4e91\u5357\u897f\u53cc\u7248\u7eb3\u5343\u5e74\u53e4\u6811\uff0c\u7ecf\u4f20\u7edf\u5de5\u827a\u7cbe\u5236\u800c\u6210\u7684\u4f18\u8d28\u719f\u8336\uff0c\u53e3\u611f\u9187\u539a\u56de\u7518\u3002",categoryId:"c1",tags:["\u666e\u6d31\u8336","\u719f\u8336","\u53e4\u6811\u8336"],rating:4.8,sold:1256,featured:!0,specifications:[{name:"\u89c4\u683c",options:["357g\u997c","200g\u5c0f\u997c","50g\u5c0f\u6cb1"]},{name:"\u5e74\u4efd",options:["2023\u5e74","2022\u5e74","2021\u5e74"]}]},{id:"p2",title:"\u91ce\u751f\u677e\u8338 - \u65b0\u9c9c\u76f4\u53d1",price:299,originalPrice:399,image:"https://example.com/products/mushroom1.jpg",images:["https://example.com/products/mushroom1.jpg","https://example.com/products/mushroom1_detail1.jpg","https://example.com/products/mushroom1_detail2.jpg"],description:"\u4e91\u5357\u9ad8\u6d77\u62d4\u5730\u533a\u91ce\u751f\u677e\u8338\uff0c48\u5c0f\u65f6\u5185\u91c7\u6458\u76f4\u53d1\uff0c\u4fdd\u6301\u6700\u4f73\u98ce\u5473\u548c\u8425\u517b\u4ef7\u503c\u3002",categoryId:"c2",tags:["\u677e\u8338","\u91ce\u751f\u83cc","\u65b0\u9c9c"],rating:4.9,sold:876,featured:!0,specifications:[{name:"\u89c4\u683c",options:["\u7cbe\u54c1\u793c\u76d2500g","\u5bb6\u5ead\u88c5300g","\u5c1d\u9c9c\u88c5100g"]}]},{id:"p3",title:"\u4e91\u5357\u5c0f\u7c92\u5496\u5561\u8c46",price:68,originalPrice:88,image:"https://example.com/products/coffee1.jpg",images:["https://example.com/products/coffee1.jpg","https://example.com/products/coffee1_detail1.jpg","https://example.com/products/coffee1_detail2.jpg"],description:"\u4e91\u5357\u4fdd\u5c71\u5c0f\u7c92\u5496\u5561\u8c46\uff0c\u4e2d\u5ea6\u70d8\u7119\uff0c\u5177\u6709\u72ec\u7279\u7684\u679c\u9999\u548c\u5de7\u514b\u529b\u98ce\u5473\u3002",categoryId:"c3",tags:["\u5496\u5561\u8c46","\u5c0f\u7c92\u5496\u5561","\u4e2d\u5ea6\u70d8\u7119"],rating:4.7,sold:2341,featured:!1,specifications:[{name:"\u89c4\u683c",options:["454g\u888b\u88c5","227g\u888b\u88c5","1kg\u888b\u88c5"]},{name:"\u7814\u78e8\u5ea6",options:["\u5496\u5561\u8c46","\u7c97\u7814\u78e8","\u4e2d\u7814\u78e8","\u7ec6\u7814\u78e8"]}]},{id:"p4",title:"\u4e91\u5357\u9ed1\u7cd6\u73ab\u7470\u82b1\u8336",price:45,originalPrice:59,image:"https://example.com/products/rosetea1.jpg",images:["https://example.com/products/rosetea1.jpg","https://example.com/products/rosetea1_detail1.jpg","https://example.com/products/rosetea1_detail2.jpg"],description:"\u7cbe\u9009\u4e91\u5357\u9ad8\u539f\u73ab\u7470\u82b1\u4e0e\u9ed1\u7cd6\u624b\u5de5\u5236\u4f5c\uff0c\u5177\u6709\u8c03\u7406\u6c14\u8840\u3001\u7f8e\u5bb9\u517b\u989c\u7684\u529f\u6548\u3002",categoryId:"c1",tags:["\u82b1\u8336","\u73ab\u7470\u82b1","\u9ed1\u7cd6"],rating:4.6,sold:1892,featured:!1,specifications:[{name:"\u89c4\u683c",options:["150g\u7f50\u88c5","300g\u7f50\u88c5","10g*12\u888b\u88c5"]}]},{id:"p5",title:"\u50a3\u65cf\u624b\u5de5\u94f6\u9970\u624b\u956f",price:328,originalPrice:398,image:"https://example.com/products/silver1.jpg",images:["https://example.com/products/silver1.jpg","https://example.com/products/silver1_detail1.jpg","https://example.com/products/silver1_detail2.jpg"],description:"\u4e91\u5357\u50a3\u65cf\u4f20\u7edf\u5de5\u827a\u5236\u4f5c\u7684\u7eaf\u94f6\u624b\u956f\uff0c\u6bcf\u4ef6\u90fd\u662f\u72ec\u7279\u7684\u827a\u672f\u54c1\uff0c\u5c55\u73b0\u5c11\u6570\u6c11\u65cf\u6587\u5316\u9b45\u529b\u3002",categoryId:"c4",tags:["\u94f6\u9970","\u624b\u5de5","\u50a3\u65cf"],rating:4.9,sold:562,featured:!0,specifications:[{name:"\u6b3e\u5f0f",options:["\u5b54\u96c0\u7eb9","\u82b1\u5349\u7eb9","\u4f20\u7edf\u7eb9"]},{name:"\u5c3a\u5bf8",options:["\u5c0f\u53f7","\u4e2d\u53f7","\u5927\u53f7"]}]}],g=[{id:"c1",title:"\u8336\u53f6",image:"https://example.com/categories/tea.jpg",description:"\u4e91\u5357\u7279\u8272\u8336\u53f6\uff0c\u5305\u62ec\u666e\u6d31\u8336\u3001\u6ec7\u7ea2\u8336\u3001\u82b1\u8336\u7b49\u591a\u79cd\u7c7b\u578b",parentId:null,productCount:24},{id:"c2",title:"\u91ce\u751f\u83cc",image:"https://example.com/categories/mushroom.jpg",description:"\u4e91\u5357\u9ad8\u539f\u7279\u8272\u91ce\u751f\u83cc\uff0c\u5305\u62ec\u677e\u8338\u3001\u725b\u809d\u83cc\u3001\u9e21\u679e\u83cc\u7b49",parentId:null,productCount:18},{id:"c3",title:"\u5496\u5561",image:"https://example.com/categories/coffee.jpg",description:"\u4e91\u5357\u5c0f\u7c92\u5496\u5561\uff0c\u4ea7\u81ea\u4e91\u5357\u4fdd\u5c71\u3001\u666e\u6d31\u7b49\u5496\u5561\u4ea7\u533a",parentId:null,productCount:12},{id:"c4",title:"\u624b\u5de5\u827a\u54c1",image:"https://example.com/categories/crafts.jpg",description:"\u4e91\u5357\u5c11\u6570\u6c11\u65cf\u624b\u5de5\u827a\u54c1\uff0c\u5305\u62ec\u94f6\u9970\u3001\u7ec7\u9526\u3001\u624e\u67d3\u7b49",parentId:null,productCount:36},{id:"c1-1",title:"\u666e\u6d31\u8336",image:"https://example.com/categories/puer.jpg",description:"\u4e91\u5357\u7279\u4ea7\u666e\u6d31\u8336\uff0c\u5206\u4e3a\u751f\u8336\u548c\u719f\u8336\u4e24\u5927\u7c7b",parentId:"c1",productCount:15},{id:"c1-2",title:"\u6ec7\u7ea2\u8336",image:"https://example.com/categories/blacktea.jpg",description:"\u4e91\u5357\u51fa\u4ea7\u7684\u7ea2\u8336\uff0c\u9999\u6c14\u9ad8\u9510\u6301\u4e45\uff0c\u6ecb\u5473\u6d53\u5f3a\u9c9c\u723d",parentId:"c1",productCount:9}],p={id:"u1",username:"test_user",nickname:"\u4e91\u5357\u7f8e\u98df\u7231\u597d\u8005",avatar:"https://example.com/avatars/default.jpg",phone:"13800138000",email:"test@example.com",level:"\u9ec4\u91d1\u4f1a\u5458",points:2580,memberSince:"2023-01-15"},f=[{id:"a1",name:"\u5f20\u4e09",phone:"13800138000",province:"\u4e91\u5357\u7701",city:"\u6606\u660e\u5e02",district:"\u4e94\u534e\u533a",address:"\u4eba\u6c11\u4e2d\u8def123\u53f7\u4e91\u5357\u5927\u53a65\u697c",isDefault:!0},{id:"a2",name:"\u5f20\u4e09",phone:"13800138000",province:"\u5317\u4eac\u5e02",city:"\u5317\u4eac\u5e02",district:"\u671d\u9633\u533a",address:"\u5efa\u56fd\u8def88\u53f7\u73b0\u4ee3\u57ce5\u53f7\u697c2\u5355\u5143801",isDefault:!1}],y=[{id:"ci1",productId:"p1",quantity:2,selectedSpecs:{"\u89c4\u683c":"357g\u997c","\u5e74\u4efd":"2023\u5e74"},price:128,addedAt:Date.now()-864e5},{id:"ci2",productId:"p2",quantity:1,selectedSpecs:{"\u89c4\u683c":"\u7cbe\u54c1\u793c\u76d2500g"},price:299,addedAt:Date.now()-36e5}];class m{shouldUseMocks(){return(0,d.Jh)().useMocks}getAllProducts(){return l}getFeaturedProducts(){return l.filter((t=>t.featured))}getNewProducts(){return[...l].sort(((t,e)=>e.id.localeCompare(t.id))).slice(0,3)}getPopularProducts(){return[...l].sort(((t,e)=>(e.sold||0)-(t.sold||0))).slice(0,3)}getProduct(t){return l.find((e=>e.id===t))}getProductsByCategory(t){return l.filter((e=>e.categoryId===t))}searchProducts(t){const e=t.toLowerCase();return l.filter((t=>t.title.toLowerCase().includes(e)||t.description.toLowerCase().includes(e)||t.tags.some((t=>t.toLowerCase().includes(e)))))}getAllCategories(){return g}getCategory(t){return g.find((e=>e.id===t))}getChildCategories(t){return g.filter((e=>e.parentId===t))}getUserProfile(){return p}getUserAddresses(){return f}getCartItems(){return y}}const S=new m,w="yunnan_taste_auth_token";class A{constructor(){(0,o.A)(this,"state",{token:null,isAuthenticated:!1,profile:null})}async initialize(){try{const t=c().getStorageSync(w);if(t){this.state.token=t,this.state.isAuthenticated=!0;const e=await u.request("/user/profile","GET",void 0,t);e.success&&e.data?this.state.profile=e.data:await this.logout()}}catch(t){console.error("Failed to initialize auth state:",t),await this.logout()}return this.state}async login(t,e){const s=await u.request("/auth/login","POST",{username:t,password:e});return s.success&&s.data&&(this.state.token=s.data.token,this.state.isAuthenticated=!0,this.state.profile=s.data.profile,c().setStorageSync(w,s.data.token)),this.state}async logout(){this.state.token=null,this.state.isAuthenticated=!1,this.state.profile=null,c().removeStorageSync(w)}getState(){return this.state}getToken(){return this.state.token}isAuthenticated(){return this.state.isAuthenticated}}const L=new A,P={getFeaturedProducts:async()=>{if(S.shouldUseMocks())return S.getFeaturedProducts();const t=await u.request("/products/featured");if(t.success&&t.data)return t.data;throw new Error(t.error||"Failed to fetch featured products")},getNewProducts:async()=>{if(S.shouldUseMocks())return S.getNewProducts();const t=await u.request("/products/new");if(t.success&&t.data)return t.data;throw new Error(t.error||"Failed to fetch new products")},getPopularProducts:async()=>{if(S.shouldUseMocks())return S.getPopularProducts();const t=await u.request("/products/popular");if(t.success&&t.data)return t.data;throw new Error(t.error||"Failed to fetch popular products")},getProduct:async t=>{if(S.shouldUseMocks()){const e=S.getProduct(t);if(e)return e;throw new Error(`Product not found: ${t}`)}const e=await u.request(`/products/${t}`);if(e.success&&e.data)return e.data;throw new Error(e.error||`Failed to fetch product: ${t}`)},getProductsByCategory:async(t,e=1,s=20)=>{if(S.shouldUseMocks()){const r=S.getProductsByCategory(t),i=(e-1)*s,o=i+s;return{products:r.slice(i,o),total:r.length,page:e,pageSize:s}}const r=await u.request(`/products?categoryId=${t}&page=${e}&pageSize=${s}`);if(r.success&&r.data)return r.data;throw new Error(r.error||`Failed to fetch products for category: ${t}`)},searchProducts:async(t,e=1,s=20)=>{if(S.shouldUseMocks()){const r=S.searchProducts(t),i=(e-1)*s,o=i+s;return{products:r.slice(i,o),total:r.length,page:e,pageSize:s}}const r=await u.request(`/products/search?query=${encodeURIComponent(t)}&page=${e}&pageSize=${s}`);if(r.success&&r.data)return r.data;throw new Error(r.error||`Failed to search products: ${t}`)},getCategories:async()=>{if(S.shouldUseMocks())return S.getAllCategories();const t=await u.request("/categories");if(t.success&&t.data)return t.data;throw new Error(t.error||"Failed to fetch categories")},getCategory:async t=>{if(S.shouldUseMocks()){const e=S.getCategory(t);if(e)return e;throw new Error(`Category not found: ${t}`)}const e=await u.request(`/categories/${t}`);if(e.success&&e.data)return e.data;throw new Error(e.error||`Failed to fetch category: ${t}`)}},C={login:async(t,e)=>{if(S.shouldUseMocks())return{token:"mock-auth-token",profile:S.getUserProfile()};const s=await u.request("/auth/login","POST",{username:t,password:e});if(s.success&&s.data)return s.data;throw new Error(s.error||"Authentication failed")},register:async(t,e,s)=>{if(S.shouldUseMocks())return{token:"mock-auth-token",profile:{...S.getUserProfile(),username:t,nickname:s}};const r=await u.request("/auth/register","POST",{username:t,password:e,nickname:s});if(r.success&&r.data)return r.data;throw new Error(r.error||"Registration failed")},getProfile:async()=>{if(S.shouldUseMocks())return S.getUserProfile();const t=L.getToken();if(!t)throw new Error("Not authenticated");const e=await u.request("/user/profile","GET",void 0,t);if(e.success&&e.data)return e.data;throw new Error(e.error||"Failed to fetch user profile")},updateProfile:async t=>{if(S.shouldUseMocks())return{...S.getUserProfile(),...t};const e=L.getToken();if(!e)throw new Error("Not authenticated");const s=await u.request("/user/profile","PUT",t,e);if(s.success&&s.data)return s.data;throw new Error(s.error||"Failed to update user profile")},getAddresses:async()=>{if(S.shouldUseMocks())return S.getUserAddresses();const t=L.getToken();if(!t)throw new Error("Not authenticated");const e=await u.request("/user/addresses","GET",void 0,t);if(e.success&&e.data)return e.data;throw new Error(e.error||"Failed to fetch addresses")},addAddress:async t=>{if(S.shouldUseMocks())return{id:`a${Date.now()}`,...t};const e=L.getToken();if(!e)throw new Error("Not authenticated");const s=await u.request("/user/addresses","POST",t,e);if(s.success&&s.data)return s.data;throw new Error(s.error||"Failed to add address")},updateAddress:async(t,e)=>{if(S.shouldUseMocks()){const s=S.getUserAddresses(),r=s.find((e=>e.id===t));if(!r)throw new Error(`Address not found: ${t}`);return{...r,...e}}const s=L.getToken();if(!s)throw new Error("Not authenticated");const r=await u.request(`/user/addresses/${t}`,"PUT",e,s);if(r.success&&r.data)return r.data;throw new Error(r.error||`Failed to update address: ${t}`)},deleteAddress:async t=>{if(S.shouldUseMocks())return;const e=L.getToken();if(!e)throw new Error("Not authenticated");const s=await u.request(`/user/addresses/${t}`,"DELETE",void 0,e);if(!s.success)throw new Error(s.error||`Failed to delete address: ${t}`)}},E={getCart:async()=>{if(S.shouldUseMocks())return{items:S.getCartItems()};const t=L.getToken();if(!t)throw new Error("Not authenticated");const e=await u.request("/cart","GET",void 0,t);if(e.success&&e.data)return e.data;throw new Error(e.error||"Failed to fetch cart")},addToCart:async(t,e,s)=>{if(S.shouldUseMocks())return{cartId:`ci${Date.now()}`};const r=L.getToken();if(!r)throw new Error("Not authenticated");const i=await u.request("/cart/items","POST",{productId:t,quantity:e,selectedSpecs:s},r);if(i.success&&i.data)return i.data;throw new Error(i.error||"Failed to add item to cart")},updateCartItem:async(t,e)=>{if(S.shouldUseMocks())return;const s=L.getToken();if(!s)throw new Error("Not authenticated");const r=await u.request(`/cart/items/${t}`,"PUT",{quantity:e},s);if(!r.success)throw new Error(r.error||`Failed to update cart item: ${t}`)},removeFromCart:async t=>{if(S.shouldUseMocks())return;const e=L.getToken();if(!e)throw new Error("Not authenticated");const s=await u.request(`/cart/items/${t}`,"DELETE",void 0,e);if(!s.success)throw new Error(s.error||`Failed to remove item from cart: ${t}`)},clearCart:async()=>{if(S.shouldUseMocks())return;const t=L.getToken();if(!t)throw new Error("Not authenticated");const e=await u.request("/cart","DELETE",void 0,t);if(!e.success)throw new Error(e.error||"Failed to clear cart")},checkout:async(t,e)=>{if(S.shouldUseMocks())return{orderId:`ord${Date.now()}`,total:427,paymentUrl:"https://example.com/payment"};const s=L.getToken();if(!s)throw new Error("Not authenticated");const r=await u.request("/orders","POST",{addressId:t,paymentMethod:e},s);if(r.success&&r.data)return r.data;throw new Error(r.error||"Checkout failed")}},T={getFeaturedArticles:async()=>{if(S.shouldUseMocks())return[{id:"a1",title:"\u4e91\u5357\u9ad8\u5c71\u8336\u7684\u56db\u5b63\u91c7\u6458\u6307\u5357",image:"https://example.com/article1.jpg",author:"\u8336\u9053\u4e13\u5bb6",date:"2025-05-15",category:"\u8336\u6587\u5316",summary:"\u4e0d\u540c\u5b63\u8282\u91c7\u6458\u7684\u9ad8\u5c71\u8336\uff0c\u98ce\u5473\u5404\u5f02\uff0c\u672c\u6587\u4e3a\u60a8\u8be6\u89e3\u56db\u5b63\u8336\u53f6\u7684\u7279\u70b9",readTime:5},{id:"a2",title:"\u63a2\u8bbf\u4e91\u5357\u91ce\u751f\u83cc\u7684\u79d8\u5bc6\u68ee\u6797",image:"https://example.com/article2.jpg",author:"\u7f8e\u98df\u63a2\u9669\u5bb6",date:"2025-05-10",category:"\u7f8e\u98df\u63a2\u7d22",summary:"\u6df1\u5165\u4e91\u5357\u539f\u59cb\u68ee\u6797\uff0c\u5bfb\u627e\u73cd\u7a00\u91ce\u751f\u83cc\u7684\u751f\u957f\u73af\u5883\u4e0e\u91c7\u6458\u6280\u5de7",readTime:8}];const t=await u.request("/content/articles/featured");if(t.success&&t.data)return t.data;throw new Error(t.error||"Failed to fetch featured articles")},getArticle:async t=>{if(S.shouldUseMocks()){if("a1"===t)return{id:"a1",title:"\u4e91\u5357\u9ad8\u5c71\u8336\u7684\u56db\u5b63\u91c7\u6458\u6307\u5357",image:"https://example.com/article1.jpg",author:"\u8336\u9053\u4e13\u5bb6",date:"2025-05-15",category:"\u8336\u6587\u5316",content:"\u4e91\u5357\u9ad8\u5c71\u8336\u56e0\u5176\u72ec\u7279\u7684\u5730\u7406\u73af\u5883\u548c\u6c14\u5019\u6761\u4ef6\uff0c\u5f62\u6210\u4e86\u56db\u5b63\u5404\u5f02\u7684\u98ce\u5473\u7279\u70b9...",readTime:5};throw new Error(`Article not found: ${t}`)}const e=await u.request(`/content/articles/${t}`);if(e.success&&e.data)return e.data;throw new Error(e.error||`Failed to fetch article: ${t}`)},getHeritageItems:async()=>{if(S.shouldUseMocks())return[{id:"h1",title:"\u666e\u6d31\u8336\u5236\u4f5c\u5de5\u827a",image:"https://example.com/heritage1.jpg",location:"\u4e91\u5357\u7701\u897f\u53cc\u7248\u7eb3",category:"\u4f20\u7edf\u5de5\u827a",description:"\u5343\u5e74\u4f20\u627f\u7684\u666e\u6d31\u8336\u5236\u4f5c\u6280\u827a\uff0c\u878d\u5408\u4e86\u4e91\u5357\u5c11\u6570\u6c11\u65cf\u7684\u667a\u6167"},{id:"h2",title:"\u50a3\u65cf\u7ec7\u9526\u6280\u827a",image:"https://example.com/heritage2.jpg",location:"\u4e91\u5357\u7701\u5fb7\u5b8f\u5dde",category:"\u4f20\u7edf\u5de5\u827a",description:"\u8272\u5f69\u7eda\u4e3d\u7684\u50a3\u65cf\u7ec7\u9526\uff0c\u8bb0\u5f55\u7740\u50a3\u65cf\u4eba\u6c11\u7684\u5386\u53f2\u4e0e\u6587\u5316"}];const t=await u.request("/content/heritage");if(t.success&&t.data)return t.data;throw new Error(t.error||"Failed to fetch heritage items")},getHeritageItem:async t=>{if(S.shouldUseMocks()){if("h1"===t)return{id:"h1",title:"\u666e\u6d31\u8336\u5236\u4f5c\u5de5\u827a",image:"https://example.com/heritage1.jpg",images:["https://example.com/heritage1.jpg","https://example.com/heritage1_detail1.jpg","https://example.com/heritage1_detail2.jpg"],location:"\u4e91\u5357\u7701\u897f\u53cc\u7248\u7eb3",category:"\u4f20\u7edf\u5de5\u827a",description:"\u5343\u5e74\u4f20\u627f\u7684\u666e\u6d31\u8336\u5236\u4f5c\u6280\u827a\uff0c\u878d\u5408\u4e86\u4e91\u5357\u5c11\u6570\u6c11\u65cf\u7684\u667a\u6167",content:"\u666e\u6d31\u8336\u5236\u4f5c\u5de5\u827a\u662f\u4e91\u5357\u7279\u6709\u7684\u4f20\u7edf\u6280\u827a\uff0c\u5386\u53f2\u53ef\u8ffd\u6eaf\u81f3\u5510\u4ee3..."};throw new Error(`Heritage item not found: ${t}`)}const e=await u.request(`/content/heritage/${t}`);if(e.success&&e.data)return e.data;throw new Error(e.error||`Failed to fetch heritage item: ${t}`)}},v={Product:P,User:C,Cart:E,Content:T};var x=s(892)["navigator"];let U=function(t){return t["NETWORK"]="network",t["AUTH"]="auth",t["NOT_FOUND"]="not_found",t["VALIDATION"]="validation",t["SERVER"]="server",t["UNKNOWN"]="unknown",t}({});class k{constructor(){(0,o.A)(this,"uiStore",null)}setUIStore(t){this.uiStore=t}handleApiError(t,e="\u64cd\u4f5c\u5931\u8d25"){const s=t?.message||e,r=t?.code||0;let i=U.UNKNOWN;!x.onLine||s.includes("network")||0===r?i=U.NETWORK:401===r||403===r?i=U.AUTH:404===r?i=U.NOT_FOUND:400===r||422===r?i=U.VALIDATION:r>=500&&(i=U.SERVER);const o={type:i,message:this.getUserFriendlyMessage(i,s),code:r,originalError:t};return this.uiStore&&this.uiStore.showToast(o.message,"error"),console.error("[API Error]",o),this.handleSpecialCases(o),o}getUserFriendlyMessage(t,e){switch(t){case U.NETWORK:return"\u7f51\u7edc\u8fde\u63a5\u5931\u8d25\uff0c\u8bf7\u68c0\u67e5\u60a8\u7684\u7f51\u7edc\u8bbe\u7f6e\u540e\u91cd\u8bd5";case U.AUTH:return"\u767b\u5f55\u5df2\u8fc7\u671f\uff0c\u8bf7\u91cd\u65b0\u767b\u5f55";case U.NOT_FOUND:return"\u8bf7\u6c42\u7684\u8d44\u6e90\u4e0d\u5b58\u5728";case U.VALIDATION:return e;case U.SERVER:return"\u670d\u52a1\u5668\u6682\u65f6\u4e0d\u53ef\u7528\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5";default:return e||"\u64cd\u4f5c\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5"}}handleSpecialCases(t){t.type===U.AUTH&&setTimeout((()=>{c().navigateTo({url:"/pages/login/index"})}),1500),t.type===U.NETWORK&&(x.onLine||c().navigateTo({url:"/pages/network-error/index"}))}}const O=new k;let F=function(t){return t["GLOBAL"]="global",t["PRODUCTS"]="products",t["CATEGORIES"]="categories",t["USER"]="user",t["CART"]="cart",t["CONTENT"]="content",t}({});class R{constructor(){(0,o.A)(this,"loadingStates",{[F.GLOBAL]:{isLoading:!1},[F.PRODUCTS]:{isLoading:!1},[F.CATEGORIES]:{isLoading:!1},[F.USER]:{isLoading:!1},[F.CART]:{isLoading:!1},[F.CONTENT]:{isLoading:!1}}),(0,a.l_)(this)}startLoading(t,e){this.loadingStates[t]={isLoading:!0,message:e},t===F.GLOBAL||this.loadingStates[F.GLOBAL].isLoading||(this.loadingStates[F.GLOBAL]={isLoading:!0,message:e||this.loadingStates[F.GLOBAL].message})}stopLoading(t){if(this.loadingStates[t]={isLoading:!1},t===F.GLOBAL)return;const e=Object.entries(this.loadingStates).filter((([t])=>t!==F.GLOBAL)).some((([t,e])=>e.isLoading));e||(this.loadingStates[F.GLOBAL]={isLoading:!1})}isLoading(t){return this.loadingStates[t].isLoading}getMessage(t){return this.loadingStates[t].message}getLoadingStates(){return this.loadingStates}}const I=new R;class N{constructor(t){(0,o.A)(this,"rootStore",void 0),(0,o.A)(this,"products",{}),(0,o.A)(this,"categories",{}),(0,o.A)(this,"featuredProducts",[]),(0,o.A)(this,"newProducts",[]),(0,o.A)(this,"popularProducts",[]),(0,o.A)(this,"searchQuery",""),(0,o.A)(this,"searchResults",[]),(0,o.A)(this,"searchHistory",[]),(0,o.A)(this,"currentFilter",{}),(0,o.A)(this,"filteredProducts",[]),(0,o.A)(this,"currentPage",1),(0,o.A)(this,"totalPages",1),(0,o.A)(this,"pageSize",20),(0,o.A)(this,"hasMoreProducts",!1),(0,o.A)(this,"isLoadingFeatured",!1),(0,o.A)(this,"isLoadingNew",!1),(0,o.A)(this,"isLoadingPopular",!1),(0,o.A)(this,"isLoadingCategories",!1),(0,o.A)(this,"isLoadingProduct",!1),(0,o.A)(this,"isLoadingSearch",!1),(0,o.A)(this,"isLoadingFiltered",!1),this.rootStore=t,(0,a.l_)(this)}async fetchFeaturedProducts(){if(!this.isLoadingFeatured){this.isLoadingFeatured=!0,I.startLoading(F.PRODUCTS,"\u52a0\u8f7d\u7cbe\u9009\u5546\u54c1...");try{const t=await v.Product.getFeaturedProducts();(0,a.h5)((()=>{t.forEach((t=>{this.products[t.id]=t})),this.featuredProducts=t.map((t=>t.id)),this.isLoadingFeatured=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingFeatured=!1,O.handleApiError(t,"\u52a0\u8f7d\u7cbe\u9009\u5546\u54c1\u5931\u8d25")}))}finally{I.stopLoading(F.PRODUCTS)}}}async fetchNewProducts(){if(!this.isLoadingNew){this.isLoadingNew=!0,I.startLoading(F.PRODUCTS,"\u52a0\u8f7d\u65b0\u54c1...");try{const t=await v.Product.getNewProducts();(0,a.h5)((()=>{t.forEach((t=>{this.products[t.id]=t})),this.newProducts=t.map((t=>t.id)),this.isLoadingNew=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingNew=!1,O.handleApiError(t,"\u52a0\u8f7d\u65b0\u54c1\u5931\u8d25")}))}finally{I.stopLoading(F.PRODUCTS)}}}async fetchPopularProducts(){if(!this.isLoadingPopular){this.isLoadingPopular=!0,I.startLoading(F.PRODUCTS,"\u52a0\u8f7d\u70ed\u95e8\u5546\u54c1...");try{const t=await v.Product.getPopularProducts();(0,a.h5)((()=>{t.forEach((t=>{this.products[t.id]=t})),this.popularProducts=t.map((t=>t.id)),this.isLoadingPopular=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingPopular=!1,O.handleApiError(t,"\u52a0\u8f7d\u70ed\u95e8\u5546\u54c1\u5931\u8d25")}))}finally{I.stopLoading(F.PRODUCTS)}}}async fetchProduct(t){if(!this.isLoadingProduct){if(this.products[t])return this.products[t];this.isLoadingProduct=!0,I.startLoading(F.PRODUCTS,"\u52a0\u8f7d\u5546\u54c1\u8be6\u60c5...");try{const e=await v.Product.getProduct(t);return(0,a.h5)((()=>{this.products[t]=e,this.isLoadingProduct=!1})),e}catch(t){return(0,a.h5)((()=>{this.isLoadingProduct=!1,O.handleApiError(t,"\u52a0\u8f7d\u5546\u54c1\u8be6\u60c5\u5931\u8d25")})),null}finally{I.stopLoading(F.PRODUCTS)}}}async fetchCategories(){if(!this.isLoadingCategories){this.isLoadingCategories=!0,I.startLoading(F.CATEGORIES,"\u52a0\u8f7d\u5206\u7c7b...");try{const t=await v.Product.getCategories();(0,a.h5)((()=>{this.categories={},t.forEach((t=>{this.categories[t.id]=t})),this.isLoadingCategories=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingCategories=!1,O.handleApiError(t,"\u52a0\u8f7d\u5206\u7c7b\u5931\u8d25")}))}finally{I.stopLoading(F.CATEGORIES)}}}async searchProducts(t,e=1){if(!this.isLoadingSearch){if(!t.trim())return this.searchResults=[],void(this.searchQuery="");this.searchQuery=t,this.isLoadingSearch=!0,I.startLoading(F.PRODUCTS,"\u641c\u7d22\u5546\u54c1...");try{const s=await v.Product.searchProducts(t,e,this.pageSize);(0,a.h5)((()=>{s.products.forEach((t=>{this.products[t.id]=t})),this.searchResults=s.products.map((t=>t.id)),this.currentPage=s.page,this.totalPages=Math.ceil(s.total/s.pageSize),this.hasMoreProducts=this.currentPage<this.totalPages,this.isLoadingSearch=!1,this.searchHistory.includes(t)||(this.searchHistory=[t,...this.searchHistory].slice(0,10),this.saveSearchHistory())}))}catch(t){(0,a.h5)((()=>{this.isLoadingSearch=!1,O.handleApiError(t,"\u641c\u7d22\u5546\u54c1\u5931\u8d25")}))}finally{I.stopLoading(F.PRODUCTS)}}}async loadMoreSearchResults(){if(this.isLoadingSearch||!this.hasMoreProducts)return;const t=this.currentPage+1;this.isLoadingSearch=!0;try{const e=await v.Product.searchProducts(this.searchQuery,t,this.pageSize);(0,a.h5)((()=>{e.products.forEach((t=>{this.products[t.id]=t})),this.searchResults=[...this.searchResults,...e.products.map((t=>t.id))],this.currentPage=e.page,this.totalPages=Math.ceil(e.total/e.pageSize),this.hasMoreProducts=this.currentPage<this.totalPages,this.isLoadingSearch=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingSearch=!1,O.handleApiError(t,"\u52a0\u8f7d\u66f4\u591a\u641c\u7d22\u7ed3\u679c\u5931\u8d25")}))}}async filterProducts(t,e=1){if(!this.isLoadingFiltered){this.currentFilter=t,this.isLoadingFiltered=!0,I.startLoading(F.PRODUCTS,"\u7b5b\u9009\u5546\u54c1...");try{if(t.categoryId){const s=await v.Product.getProductsByCategory(t.categoryId,e,this.pageSize);(0,a.h5)((()=>{s.products.forEach((t=>{this.products[t.id]=t})),this.filteredProducts=s.products.map((t=>t.id)),this.currentPage=s.page,this.totalPages=Math.ceil(s.total/s.pageSize),this.hasMoreProducts=this.currentPage<this.totalPages,this.isLoadingFiltered=!1}))}else(0,a.h5)((()=>{this.filteredProducts=[],this.currentPage=1,this.totalPages=1,this.hasMoreProducts=!1,this.isLoadingFiltered=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingFiltered=!1,O.handleApiError(t,"\u7b5b\u9009\u5546\u54c1\u5931\u8d25")}))}finally{I.stopLoading(F.PRODUCTS)}}}async loadMoreFilteredProducts(){if(this.isLoadingFiltered||!this.hasMoreProducts)return;const t=this.currentPage+1;this.isLoadingFiltered=!0;try{if(this.currentFilter.categoryId){const e=await v.Product.getProductsByCategory(this.currentFilter.categoryId,t,this.pageSize);(0,a.h5)((()=>{e.products.forEach((t=>{this.products[t.id]=t})),this.filteredProducts=[...this.filteredProducts,...e.products.map((t=>t.id))],this.currentPage=e.page,this.totalPages=Math.ceil(e.total/e.pageSize),this.hasMoreProducts=this.currentPage<this.totalPages,this.isLoadingFiltered=!1}))}}catch(t){(0,a.h5)((()=>{this.isLoadingFiltered=!1,O.handleApiError(t,"\u52a0\u8f7d\u66f4\u591a\u7b5b\u9009\u5546\u54c1\u5931\u8d25")}))}}clearSearchHistory(){this.searchHistory=[],this.saveSearchHistory()}saveSearchHistory(){try{c().setStorageSync("yunnan_taste_search_history",JSON.stringify(this.searchHistory))}catch(t){console.error("Failed to save search history:",t)}}loadSearchHistory(){try{const t=c().getStorageSync("yunnan_taste_search_history");t&&(this.searchHistory=JSON.parse(t))}catch(t){console.error("Failed to load search history:",t)}}async hydrate(){this.loadSearchHistory()}}class b{constructor(t){(0,o.A)(this,"rootStore",void 0),(0,o.A)(this,"isAuthenticated",!1),(0,o.A)(this,"token",null),(0,o.A)(this,"profile",null),(0,o.A)(this,"addresses",[]),(0,o.A)(this,"favorites",[]),(0,o.A)(this,"viewHistory",[]),(0,o.A)(this,"isLoading",!1),(0,o.A)(this,"isLoadingProfile",!1),(0,o.A)(this,"isLoadingAddresses",!1),(0,o.A)(this,"isAuthenticating",!1),this.rootStore=t,(0,a.l_)(this)}async initialize(){this.isLoading=!0,I.startLoading(F.USER,"\u521d\u59cb\u5316\u7528\u6237\u72b6\u6001...");try{const t=await L.initialize();(0,a.h5)((()=>{this.isAuthenticated=t.isAuthenticated,this.token=t.token,this.profile=t.profile})),this.isAuthenticated&&(await this.fetchAddresses(),await this.loadFavorites(),await this.loadViewHistory())}catch(t){O.handleApiError(t,"\u521d\u59cb\u5316\u7528\u6237\u72b6\u6001\u5931\u8d25")}finally{(0,a.h5)((()=>{this.isLoading=!1})),I.stopLoading(F.USER)}}async login(t,e){if(this.isAuthenticating)return!1;this.isAuthenticating=!0,I.startLoading(F.USER,"\u767b\u5f55\u4e2d...");try{const s=await L.login(t,e);return(0,a.h5)((()=>{this.isAuthenticated=s.isAuthenticated,this.token=s.token,this.profile=s.profile,this.isAuthenticating=!1})),this.isAuthenticated?(await this.fetchAddresses(),await this.loadFavorites(),await this.loadViewHistory(),this.rootStore.uiStore.showToast("\u767b\u5f55\u6210\u529f","success"),!0):(this.rootStore.uiStore.showToast("\u767b\u5f55\u5931\u8d25","error"),!1)}catch(t){return(0,a.h5)((()=>{this.isAuthenticating=!1})),O.handleApiError(t,"\u767b\u5f55\u5931\u8d25"),!1}finally{I.stopLoading(F.USER)}}async register(t,e,s){if(this.isAuthenticating)return!1;this.isAuthenticating=!0,I.startLoading(F.USER,"\u6ce8\u518c\u4e2d...");try{const r=await v.User.register(t,e,s);return(0,a.h5)((()=>{this.isAuthenticated=!0,this.token=r.token,this.profile=r.profile,this.isAuthenticating=!1})),this.favorites=[],this.viewHistory=[],this.addresses=[],this.rootStore.uiStore.showToast("\u6ce8\u518c\u6210\u529f","success"),!0}catch(t){return(0,a.h5)((()=>{this.isAuthenticating=!1})),O.handleApiError(t,"\u6ce8\u518c\u5931\u8d25"),!1}finally{I.stopLoading(F.USER)}}async logout(){I.startLoading(F.USER,"\u9000\u51fa\u767b\u5f55...");try{await L.logout(),(0,a.h5)((()=>{this.isAuthenticated=!1,this.token=null,this.profile=null,this.addresses=[],this.favorites=[],this.viewHistory=[]})),this.rootStore.uiStore.showToast("\u5df2\u9000\u51fa\u767b\u5f55","info")}catch(t){O.handleApiError(t,"\u9000\u51fa\u767b\u5f55\u5931\u8d25")}finally{I.stopLoading(F.USER)}}async fetchProfile(){if(this.isAuthenticated&&!this.isLoadingProfile){this.isLoadingProfile=!0,I.startLoading(F.USER,"\u52a0\u8f7d\u7528\u6237\u4fe1\u606f...");try{const t=await v.User.getProfile();(0,a.h5)((()=>{this.profile=t,this.isLoadingProfile=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingProfile=!1})),O.handleApiError(t,"\u52a0\u8f7d\u7528\u6237\u4fe1\u606f\u5931\u8d25")}finally{I.stopLoading(F.USER)}}}async updateProfile(t){if(this.isAuthenticated&&!this.isLoadingProfile){this.isLoadingProfile=!0,I.startLoading(F.USER,"\u66f4\u65b0\u7528\u6237\u4fe1\u606f...");try{const e=await v.User.updateProfile(t);(0,a.h5)((()=>{this.profile=e,this.isLoadingProfile=!1})),this.rootStore.uiStore.showToast("\u7528\u6237\u4fe1\u606f\u5df2\u66f4\u65b0","success")}catch(t){(0,a.h5)((()=>{this.isLoadingProfile=!1})),O.handleApiError(t,"\u66f4\u65b0\u7528\u6237\u4fe1\u606f\u5931\u8d25")}finally{I.stopLoading(F.USER)}}}async fetchAddresses(){if(this.isAuthenticated&&!this.isLoadingAddresses){this.isLoadingAddresses=!0,I.startLoading(F.USER,"\u52a0\u8f7d\u5730\u5740\u4fe1\u606f...");try{const t=await v.User.getAddresses();(0,a.h5)((()=>{this.addresses=t,this.isLoadingAddresses=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingAddresses=!1})),O.handleApiError(t,"\u52a0\u8f7d\u5730\u5740\u4fe1\u606f\u5931\u8d25")}finally{I.stopLoading(F.USER)}}}async addAddress(t){if(this.isAuthenticated&&!this.isLoadingAddresses){this.isLoadingAddresses=!0,I.startLoading(F.USER,"\u6dfb\u52a0\u5730\u5740...");try{const e=await v.User.addAddress(t);(0,a.h5)((()=>{e.isDefault&&(this.addresses=this.addresses.map((t=>({...t,isDefault:!1})))),this.addresses=[...this.addresses,e],this.isLoadingAddresses=!1})),this.rootStore.uiStore.showToast("\u5730\u5740\u5df2\u6dfb\u52a0","success")}catch(t){(0,a.h5)((()=>{this.isLoadingAddresses=!1})),O.handleApiError(t,"\u6dfb\u52a0\u5730\u5740\u5931\u8d25")}finally{I.stopLoading(F.USER)}}}async updateAddress(t,e){if(this.isAuthenticated&&!this.isLoadingAddresses){this.isLoadingAddresses=!0,I.startLoading(F.USER,"\u66f4\u65b0\u5730\u5740...");try{const s=await v.User.updateAddress(t,e);(0,a.h5)((()=>{s.isDefault?this.addresses=this.addresses.map((e=>({...e,isDefault:e.id===t}))):this.addresses=this.addresses.map((e=>e.id===t?s:e)),this.isLoadingAddresses=!1})),this.rootStore.uiStore.showToast("\u5730\u5740\u5df2\u66f4\u65b0","success")}catch(t){(0,a.h5)((()=>{this.isLoadingAddresses=!1})),O.handleApiError(t,"\u66f4\u65b0\u5730\u5740\u5931\u8d25")}finally{I.stopLoading(F.USER)}}}async deleteAddress(t){if(this.isAuthenticated&&!this.isLoadingAddresses){this.isLoadingAddresses=!0,I.startLoading(F.USER,"\u5220\u9664\u5730\u5740...");try{await v.User.deleteAddress(t),(0,a.h5)((()=>{this.addresses=this.addresses.filter((e=>e.id!==t)),this.isLoadingAddresses=!1})),this.rootStore.uiStore.showToast("\u5730\u5740\u5df2\u5220\u9664","success")}catch(t){(0,a.h5)((()=>{this.isLoadingAddresses=!1})),O.handleApiError(t,"\u5220\u9664\u5730\u5740\u5931\u8d25")}finally{I.stopLoading(F.USER)}}}toggleFavorite(t){if(!this.isAuthenticated)return void this.rootStore.uiStore.showToast("\u8bf7\u5148\u767b\u5f55","info");const e=this.favorites.includes(t);e?(this.favorites=this.favorites.filter((e=>e!==t)),this.rootStore.uiStore.showToast("\u5df2\u53d6\u6d88\u6536\u85cf","info")):(this.favorites=[...this.favorites,t],this.rootStore.uiStore.showToast("\u5df2\u52a0\u5165\u6536\u85cf","success")),this.saveFavorites()}addToViewHistory(t){this.isAuthenticated&&(this.viewHistory=this.viewHistory.filter((e=>e!==t)),this.viewHistory=[t,...this.viewHistory],this.viewHistory.length>50&&(this.viewHistory=this.viewHistory.slice(0,50)),this.saveViewHistory())}saveFavorites(){try{c().setStorageSync("yunnan_taste_favorites",JSON.stringify(this.favorites))}catch(t){console.error("Failed to save favorites:",t)}}loadFavorites(){try{const t=c().getStorageSync("yunnan_taste_favorites");t&&(this.favorites=JSON.parse(t))}catch(t){console.error("Failed to load favorites:",t)}}saveViewHistory(){try{c().setStorageSync("yunnan_taste_view_history",JSON.stringify(this.viewHistory))}catch(t){console.error("Failed to save view history:",t)}}loadViewHistory(){try{const t=c().getStorageSync("yunnan_taste_view_history");t&&(this.viewHistory=JSON.parse(t))}catch(t){console.error("Failed to load view history:",t)}}async hydrate(){await this.initialize()}}class M{constructor(t){(0,o.A)(this,"rootStore",void 0),(0,o.A)(this,"items",[]),(0,o.A)(this,"orders",[]),(0,o.A)(this,"isLoadingCart",!1),(0,o.A)(this,"isLoadingOrders",!1),(0,o.A)(this,"isProcessingOrder",!1),this.rootStore=t,(0,a.l_)(this)}async fetchCart(){if(this.rootStore.userStore.isAuthenticated){if(!this.isLoadingCart){this.isLoadingCart=!0,I.startLoading(F.CART,"\u52a0\u8f7d\u8d2d\u7269\u8f66...");try{const t=await v.Cart.getCart();(0,a.h5)((()=>{this.items=t.items,this.isLoadingCart=!1}))}catch(t){(0,a.h5)((()=>{this.isLoadingCart=!1})),O.handleApiError(t,"\u52a0\u8f7d\u8d2d\u7269\u8f66\u5931\u8d25")}finally{I.stopLoading(F.CART)}}}else this.loadLocalCart()}async addItem(t,e,s){if(!this.isLoadingCart){this.isLoadingCart=!0,I.startLoading(F.CART,"\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66...");try{const r=await this.rootStore.productStore.fetchProduct(t);if(!r)throw new Error("\u5546\u54c1\u4e0d\u5b58\u5728");if(this.rootStore.userStore.isAuthenticated){const i=await v.Cart.addToCart(t,e,s);(0,a.h5)((()=>{this.items.push({id:i.cartId,productId:t,quantity:e,selectedSpecs:s,price:r.price,addedAt:Date.now()})}))}else(0,a.h5)((()=>{const i=this.items.findIndex((e=>e.productId===t&&JSON.stringify(e.selectedSpecs)===JSON.stringify(s)));i>=0?this.items[i].quantity+=e:this.items.push({id:`local-${Date.now()}`,productId:t,quantity:e,selectedSpecs:s,price:r.price,addedAt:Date.now()}),this.saveLocalCart()}));this.rootStore.uiStore.showToast("\u5df2\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66","success")}catch(t){O.handleApiError(t,"\u6dfb\u52a0\u5230\u8d2d\u7269\u8f66\u5931\u8d25")}finally{(0,a.h5)((()=>{this.isLoadingCart=!1})),I.stopLoading(F.CART)}}}async updateItemQuantity(t,e){if(!this.isLoadingCart&&!(e<1)){this.isLoadingCart=!0,I.startLoading(F.CART,"\u66f4\u65b0\u8d2d\u7269\u8f66...");try{this.rootStore.userStore.isAuthenticated&&await v.Cart.updateCartItem(t,e),(0,a.h5)((()=>{this.items=this.items.map((s=>s.id===t?{...s,quantity:e}:s)),this.rootStore.userStore.isAuthenticated||this.saveLocalCart()}))}catch(t){O.handleApiError(t,"\u66f4\u65b0\u8d2d\u7269\u8f66\u5931\u8d25")}finally{(0,a.h5)((()=>{this.isLoadingCart=!1})),I.stopLoading(F.CART)}}}async removeItem(t){if(!this.isLoadingCart){this.isLoadingCart=!0,I.startLoading(F.CART,"\u79fb\u9664\u5546\u54c1...");try{this.rootStore.userStore.isAuthenticated&&await v.Cart.removeFromCart(t),(0,a.h5)((()=>{this.items=this.items.filter((e=>e.id!==t)),this.rootStore.userStore.isAuthenticated||this.saveLocalCart()})),this.rootStore.uiStore.showToast("\u5546\u54c1\u5df2\u79fb\u9664","success")}catch(t){O.handleApiError(t,"\u79fb\u9664\u5546\u54c1\u5931\u8d25")}finally{(0,a.h5)((()=>{this.isLoadingCart=!1})),I.stopLoading(F.CART)}}}async clearCart(){if(!this.isLoadingCart){this.isLoadingCart=!0,I.startLoading(F.CART,"\u6e05\u7a7a\u8d2d\u7269\u8f66...");try{this.rootStore.userStore.isAuthenticated&&await v.Cart.clearCart(),(0,a.h5)((()=>{this.items=[],this.rootStore.userStore.isAuthenticated||this.saveLocalCart()})),this.rootStore.uiStore.showToast("\u8d2d\u7269\u8f66\u5df2\u6e05\u7a7a","success")}catch(t){O.handleApiError(t,"\u6e05\u7a7a\u8d2d\u7269\u8f66\u5931\u8d25")}finally{(0,a.h5)((()=>{this.isLoadingCart=!1})),I.stopLoading(F.CART)}}}async checkout(t,e){if(!this.rootStore.userStore.isAuthenticated)return this.rootStore.uiStore.showToast("\u8bf7\u5148\u767b\u5f55","info"),null;if(this.isProcessingOrder)return null;if(0===this.items.length)return this.rootStore.uiStore.showToast("\u8d2d\u7269\u8f66\u4e3a\u7a7a","info"),null;this.isProcessingOrder=!0,I.startLoading(F.CART,"\u63d0\u4ea4\u8ba2\u5355...");try{const s=await v.Cart.checkout(t,e);return(0,a.h5)((()=>{this.items=[]})),this.rootStore.uiStore.showToast("\u8ba2\u5355\u63d0\u4ea4\u6210\u529f","success"),s.paymentUrl||s.orderId}catch(t){return O.handleApiError(t,"\u63d0\u4ea4\u8ba2\u5355\u5931\u8d25"),null}finally{(0,a.h5)((()=>{this.isProcessingOrder=!1})),I.stopLoading(F.CART)}}get cartTotal(){return this.items.reduce(((t,e)=>t+e.price*e.quantity),0)}get itemCount(){return this.items.reduce(((t,e)=>t+e.quantity),0)}saveLocalCart(){try{c().setStorageSync("yunnan_taste_cart",JSON.stringify(this.items))}catch(t){console.error("Failed to save cart:",t)}}loadLocalCart(){try{const t=c().getStorageSync("yunnan_taste_cart");t&&(this.items=JSON.parse(t))}catch(t){console.error("Failed to load cart:",t)}}async mergeWithServerCart(){if(!this.rootStore.userStore.isAuthenticated)return;const t=c().getStorageSync("yunnan_taste_cart");if(!t)return;const e=JSON.parse(t);if(0!==e.length){I.startLoading(F.CART,"\u540c\u6b65\u8d2d\u7269\u8f66...");try{await this.fetchCart();for(const t of e)await v.Cart.addToCart(t.productId,t.quantity,t.selectedSpecs);await this.fetchCart(),c().removeStorageSync("yunnan_taste_cart"),this.rootStore.uiStore.showToast("\u8d2d\u7269\u8f66\u5df2\u540c\u6b65","success")}catch(t){O.handleApiError(t,"\u540c\u6b65\u8d2d\u7269\u8f66\u5931\u8d25")}finally{I.stopLoading(F.CART)}}}async hydrate(){this.rootStore.userStore.isAuthenticated?(await this.fetchCart(),await this.mergeWithServerCart()):this.loadLocalCart()}}class _{constructor(t){(0,o.A)(this,"rootStore",void 0),(0,o.A)(this,"activeToast",{visible:!1,message:"",type:"info",options:{duration:3e3,position:"bottom"}}),(0,o.A)(this,"isLoading",!1),(0,o.A)(this,"loadingMessage",void 0),(0,o.A)(this,"themeSettings",{darkMode:!1,animationsEnabled:!0,reducedMotion:!1}),(0,o.A)(this,"currentEnvironment",d.OH.DEVELOPMENT),this.rootStore=t,(0,a.l_)(this),O.setUIStore(this),this.loadSettings()}showToast(t,e="info",s){this.activeToast={visible:!0,message:t,type:e,options:{...this.activeToast.options,...s}};const r="error"===e?"none":"success"===e?"success":"none";c().showToast({title:t,icon:r,duration:s?.duration||this.activeToast.options.duration}),setTimeout((()=>{this.hideToast()}),s?.duration||this.activeToast.options.duration)}hideToast(){this.activeToast.visible=!1}setLoading(t,e,s=F.GLOBAL){t?I.startLoading(s,e):I.stopLoading(s),this.isLoading=I.isLoading(F.GLOBAL),this.loadingMessage=I.getMessage(F.GLOBAL),this.isLoading?c().showLoading({title:this.loadingMessage||"\u52a0\u8f7d\u4e2d...",mask:!0}):c().hideLoading()}isLoadingType(t){return I.isLoading(t)}updateThemeSettings(t){this.themeSettings={...this.themeSettings,...t},this.saveSettings()}setEnvironment(t){this.currentEnvironment=t,(0,d.kN)(t);const e={[d.OH.DEVELOPMENT]:"\u5f00\u53d1\u73af\u5883",[d.OH.STAGING]:"\u6d4b\u8bd5\u73af\u5883",[d.OH.PRODUCTION]:"\u751f\u4ea7\u73af\u5883"};this.showToast(`\u5df2\u5207\u6362\u5230${e[t]}`,"info")}saveSettings(){try{c().setStorageSync("yunnan_taste_ui_settings",JSON.stringify(this.themeSettings))}catch(t){console.error("Failed to save UI settings:",t)}}loadSettings(){try{const t=c().getStorageSync("yunnan_taste_ui_settings");t&&(this.themeSettings={...this.themeSettings,...JSON.parse(t)})}catch(t){console.error("Failed to load UI settings:",t)}}async hydrate(){this.loadSettings()}}class D{constructor(){(0,o.A)(this,"productStore",void 0),(0,o.A)(this,"userStore",void 0),(0,o.A)(this,"cartStore",void 0),(0,o.A)(this,"uiStore",void 0),this.productStore=new N(this),this.userStore=new b(this),this.cartStore=new M(this),this.uiStore=new _(this),(0,a.l_)(this)}async hydrate(){await Promise.all([this.productStore.hydrate(),this.userStore.hydrate(),this.cartStore.hydrate(),this.uiStore.hydrate()])}}const j=new D;var q=s(118),H=s(3146),$=s(4848);const z=(0,r.createContext)(null),B=((0,i.PA)((({children:t})=>{const[e,s]=(0,r.useState)(!1);return(0,r.useEffect)((()=>{const t=async()=>{await j.hydrate(),s(!0)};t()}),[]),e?(0,$.jsxs)(z.Provider,{value:j,children:[t,j.uiStore.isLoading&&(0,$.jsx)(q.Ss,{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:9999},children:(0,$.jsx)(H.R,{size:"lg",variant:"dots",text:j.uiStore.loadingText})}),j.uiStore.toastVisible&&(0,$.jsx)(q.Ss,{style:{position:"fixed",top:"20px",left:"50%",transform:"translateX(-50%)",padding:"10px 20px",borderRadius:"4px",backgroundColor:(()=>{switch(j.uiStore.toastType){case"success":return"var(--color-success)";case"warning":return"var(--color-warning)";case"error":return"var(--color-error)";default:return"var(--color-primary)"}})(),color:"white",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.2)",zIndex:9999},children:j.uiStore.toastMessage}),j.uiStore.modalVisible&&j.uiStore.modalContent&&(0,$.jsx)(q.Ss,{style:{position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:9999},children:(0,$.jsx)(q.Ss,{style:{width:"80%",maxWidth:"600px",backgroundColor:"var(--color-backgroundAlt)",borderRadius:"8px",overflow:"hidden",boxShadow:"var(--shadow-lg)"},children:j.uiStore.modalContent})})]}):(0,$.jsx)(q.Ss,{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,$.jsx)(H.R,{size:"lg",variant:"dots",text:"\u521d\u59cb\u5316\u4e2d..."})})})),()=>{const t=(0,r.useContext)(z);if(!t)throw new Error("useStore must be used within StoreProvider");return t}),G=()=>B().productStore,V=()=>B().userStore,J=()=>B().cartStore,W=()=>B().uiStore},7908:function(t,e,s){s.d(e,{DP:function(){return d}});var r=s(6540);const i={id:"bioluminescent-forest",name:"Bioluminescent Forest",colors:{primary:"#0A3B3C",primaryLight:"#1A5859",primaryDark:"#052728",secondary:"#06D6A0",secondaryLight:"#39E8BC",secondaryDark:"#05B384",accent1:"#26F7C7",accent2:"#4CC9F0",accent3:"#F72585",success:"#06D6A0",warning:"#F9C846",error:"#F72585",info:"#4CC9F0",background:"#041F20",backgroundAlt:"#072F30",backgroundDark:"#031516",textPrimary:"#E9F5F5",textSecondary:"#B7DBDB",textDisabled:"#6A9797",textInverse:"#041F20",border:"#0A3B3C",borderLight:"#1A5859",divider:"#0D4546"},typography:{fontFamily:{primary:"PingFang SC, -apple-system, BlinkMacSystemFont, Helvetica Neue, Helvetica, Segoe UI, Arial, Roboto, sans-serif",secondary:"Georgia, serif"},fontWeight:{light:300,regular:400,medium:500,bold:700},fontSize:{xs:"12px",sm:"14px",md:"16px",lg:"18px",xl:"20px",xxl:"24px",display:"32px"},lineHeight:{tight:1.2,normal:1.5,relaxed:1.8}},spacing:{xs:"4px",sm:"8px",md:"16px",lg:"24px",xl:"32px",xxl:"48px"},borders:{radius:{none:"0",sm:"4px",md:"8px",lg:"16px",full:"9999px"},width:{none:"0",thin:"1px",normal:"2px",thick:"4px"}},effects:{shadows:{none:"none",sm:"0 2px 4px rgba(3, 21, 22, 0.3)",md:"0 4px 8px rgba(3, 21, 22, 0.4)",lg:"0 8px 16px rgba(3, 21, 22, 0.5)"},glows:{none:"none",sm:"0 0 4px rgba(38, 247, 199, 0.4)",md:"0 0 8px rgba(38, 247, 199, 0.6)",lg:"0 0 16px rgba(38, 247, 199, 0.8)",pulse:"0 0 20px rgba(38, 247, 199, 0.8)"},gradients:{primary:"linear-gradient(135deg, #0A3B3C 0%, #1A5859 100%)",secondary:"linear-gradient(135deg, #05B384 0%, #06D6A0 100%)",accent:"linear-gradient(135deg, #26F7C7 0%, #4CC9F0 100%)",background:"linear-gradient(180deg, #041F20 0%, #031516 100%)"}},animations:{durations:{fast:"0.2s",normal:"0.4s",slow:"0.8s",verySlow:"2s"},easings:{easeIn:"cubic-bezier(0.4, 0, 1, 1)",easeOut:"cubic-bezier(0, 0, 0.2, 1)",easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",bounce:"cubic-bezier(0.68, -0.55, 0.27, 1.55)"},transitions:{default:"0.4s cubic-bezier(0.4, 0, 0.2, 1)",fade:"0.4s cubic-bezier(0.4, 0, 0.2, 1)",scale:"0.4s cubic-bezier(0.4, 0, 0.2, 1)",slide:"0.4s cubic-bezier(0.4, 0, 0.2, 1)",glow:"2s cubic-bezier(0.4, 0, 0.2, 1)"}}};var o=i;s(4848);const a=o,n={[o.id]:o},c=(0,r.createContext)({theme:a,setTheme:()=>{},availableThemes:Object.keys(n)}),d=()=>(0,r.useContext)(c);s(758)}}]);